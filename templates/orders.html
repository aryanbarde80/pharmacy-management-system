{% extends 'base.html' %}

{% block content %}
<div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
  <div>
    <h2 class="text-3xl font-bold text-gray-800 page-title">{{ _('orders') }}</h2>
    <p class="mt-1 text-gray-500">{{ _('manage_orders') }}</p>
  </div>
  <div class="mt-4 md:mt-0">
    <a href="{{ url_for('create_order') }}" class="btn-primary flex items-center gap-2">
      <span class="material-symbols-outlined">add</span>
      {{ _('new_order') }}
    </a>
  </div>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5 mb-6">
  <div class="card hover-raise p-5">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm font-medium text-gray-500">{{ _('total_orders') }}</p>
        <p class="mt-1 text-2xl font-bold text-gray-800">{{ stats.total_orders }}</p>
      </div>
      <div class="p-3 rounded-lg bg-blue-50 text-blue-600">
        <span class="material-symbols-outlined">receipt_long</span>
      </div>
    </div>
  </div>

  <div class="card hover-raise p-5">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm font-medium text-gray-500">{{ _('pending') }}</p>
        <p class="mt-1 text-2xl font-bold text-gray-800">{{ stats.pending }}</p>
      </div>
      <div class="p-3 rounded-lg bg-amber-50 text-amber-600">
        <span class="material-symbols-outlined">pending_actions</span>
      </div>
    </div>
  </div>

  <div class="card hover-raise p-5">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm font-medium text-gray-500">{{ _('this_month') }}</p>
        <p class="mt-1 text-2xl font-bold text-gray-800">DZD {{ stats.month_total }}</p>
      </div>
      <div class="p-3 rounded-lg bg-green-50 text-green-600">
        <span class="material-symbols-outlined">paid</span>
      </div>
    </div>
  </div>

  <div class="card hover-raise p-5">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm font-medium text-gray-500">{{ _('average_order_value') }}</p>
        <p class="mt-1 text-2xl font-bold text-gray-800">{{ stats.avg_order_value if stats.avg_order_value is not none else '-' }} DZD</p>
      </div>
      <div class="p-3 rounded-lg bg-purple-50 text-purple-600">
        <span class="material-symbols-outlined">shopping_cart</span>
      </div>
    </div>
  </div>
</div>

<!-- Filters and Search -->
<div class="card p-5 mb-6">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div class="relative flex-1 max-w-md">
      <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
        <span class="material-symbols-outlined">search</span>
      </span>
      <input type="text" class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500" placeholder="{{ _('search_orders') }}">
    </div>
    <div class="flex flex-wrap gap-3">
      <select class="form-input text-sm py-1.5">
        <option>{{ _('all_statuses') }}</option>
        <option>{{ _('pending') }}</option>
        <option>{{ _('processing') }}</option>
        <option>{{ _('shipped') }}</option>
        <option>{{ _('delivered') }}</option>
        <option>{{ _('cancelled') }}</option>
      </select>
      <select class="form-input text-sm py-1.5">
        <option>{{ _('all_periods') }}</option>
        <option>{{ _('today') }}</option>
        <option>{{ _('this_week') }}</option>
        <option>{{ _('this_month') }}</option>
        <option>{{ _('last_30_days') }}</option>
      </select>
      <button class="btn-ghost text-sm flex items-center gap-1">
        <span class="material-symbols-outlined text-base">filter_alt</span>
        {{ _('more_filters') }}
      </button>
    </div>
  </div>
</div>

<!-- Orders Table -->
<div class="card overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-gray-50">
        <tr class="text-sm font-medium text-gray-500">
          <th class="px-6 py-3">{{ _('order') }}</th>
          <th class="px-6 py-3">{{ _('customer') }}</th>
          <th class="px-6 py-3">{{ _('date') }}</th>
          <th class="px-6 py-3">{{ _('items') }}</th>
          <th class="px-6 py-3">{{ _('total') }}</th>
          <th class="px-6 py-3">{{ _('status') }}</th>
          <th class="px-6 py-3">{{ _('actions') }}</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        {% if orders and orders|length > 0 %}
          {% for o in orders %}
          {% set code = o.code or o.id or '-' %}
          {% set customer = o.customer or o.client or o.supplier or '-' %}
          {% set email = o.email or o.customer_email or '' %}
          {% set items_count = o.items_count or (o.items|length if o.items is defined and o.items else 0) %}
          {% set total = o.total or o.amount or '' %}
          {% set status = o.status or '-' %}
          {% set status_l = status|string|lower %}
          {% set cls = 'bg-gray-100 text-gray-800' %}
          {% if 'cancel' in status_l or 'ملغ' in status_l %}
            {% set cls = 'bg-red-100 text-red-800' %}
          {% elif 'pend' in status_l or 'انتظار' in status_l %}
            {% set cls = 'bg-amber-100 text-amber-800' %}
          {% elif 'process' in status_l or 'معالج' in status_l %}
            {% set cls = 'bg-blue-100 text-blue-800' %}
          {% elif 'ship' in status_l or 'شحن' in status_l or 'deliv' in status_l or 'تسليم' in status_l or 'توصيل' in status_l %}
            {% set cls = 'bg-green-100 text-green-800' %}
          {% endif %}
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="px-6 py-4 font-medium text-gray-900">
              <div class="flex items-center gap-3">
                <div class="w-9 h-9 rounded-lg bg-blue-50 flex items-center justify-center">
                  <span class="material-symbols-outlined text-blue-600">receipt</span>
                </div>
                #{{ code }}
              </div>
            </td>
            <td class="px-6 py-4">
              <div class="font-medium">{{ customer }}</div>
              {% if email %}<div class="text-sm text-gray-500">{{ email }}</div>{% endif %}
            </td>
            <td class="px-6 py-4">
              <div>
                {{ o.date.strftime('%Y-%m-%d %H:%M') if o.date and o.date.strftime is defined else (o.date if o.date else '-') }}
              </div>
            </td>
            <td class="px-6 py-4 font-medium">{{ items_count }}</td>
            <td class="px-6 py-4 font-medium">{% if total %}{{ total }}{% else %}-{% endif %}</td>
            <td class="px-6 py-4">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ cls }}">
                {{ status }}
              </span>
            </td>
            <td class="px-6 py-4">
              <div class="flex gap-2">
                <button class="text-blue-600 hover:bg-blue-50 p-1.5 rounded-lg" title="{{ _('view') }}">
                  <span class="material-symbols-outlined text-xl">visibility</span>
                </button>
                <button class="text-gray-400 hover:bg-gray-100 p-1.5 rounded-lg" title="{{ _('print') }}">
                  <span class="material-symbols-outlined text-xl">print</span>
                </button>
                <button class="text-gray-400 hover:bg-gray-100 p-1.5 rounded-lg" title="{{ _('more') }}">
                  <span class="material-symbols-outlined text-xl">more_vert</span>
                </button>
              </div>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
              <td colspan="7" class="px-6 py-8 text-center text-gray-500">{{ _('no_orders') }}</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  
  <!-- Pagination -->
  <div class="px-6 py-4 border-t border-gray-100 flex items-center justify-between">
    <div class="text-sm text-gray-500">
      {{ _('showing') }} <span class="font-medium">1</span> {{ _('to') }} <span class="font-medium">3</span> {{ _('of') }} <span class="font-medium">24</span> {{ _('results') }}
    </div>
    <div class="flex items-center gap-2">
      <button class="p-2 rounded-lg border border-gray-200 text-gray-500 hover:bg-gray-50 disabled:opacity-50" disabled>
        <span class="material-symbols-outlined">chevron_right</span>
      </button>
      <button class="w-10 h-10 rounded-lg bg-cyan-600 text-white font-medium">1</button>
      <button class="w-10 h-10 rounded-lg text-gray-600 hover:bg-gray-100 font-medium">2</button>
      <button class="w-10 h-10 rounded-lg text-gray-600 hover:bg-gray-100 font-medium">3</button>
      <span class="px-2 text-gray-400">...</span>
      <button class="w-10 h-10 rounded-lg text-gray-600 hover:bg-gray-100 font-medium">8</button>
      <button class="p-2 rounded-lg border border-gray-200 text-gray-500 hover:bg-gray-50">
        <span class="material-symbols-outlined">chevron_left</span>
      </button>
    </div>
  </div>
</div>
{% endblock %}
